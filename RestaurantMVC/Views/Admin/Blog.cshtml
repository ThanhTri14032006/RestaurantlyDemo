@model IEnumerable<RestaurantMVC.Models.BlogEntry>
@{
    ViewData["Title"] = "/Admin/Blog";
    Layout = "_AdminLayout";
}

<section class="py-4 admin-page">
  <div class="container">
    <!-- Hero header -->
    <div class="p-4 p-md-5 mb-4 rounded-3" style="background: linear-gradient(135deg, #4e73df 0%, #36b9cc 100%); color: #fff; box-shadow: 0 10px 30px rgba(0,0,0,.2);">
      <div class="d-flex flex-wrap align-items-center justify-content-between">
        <div>
          <h1 class="h3 mb-1"><i class="fas fa-blog me-2"></i>Quản lý Blog</h1>
        </div>
        <div class="page-actions d-flex align-items-center mt-3 mt-md-0">
          <a class="btn btn-light text-dark fw-semibold" href="@Url.Action("CreateBlogEntry")">
            <i class="fas fa-plus me-2"></i>Thêm bài viết
          </a>
        </div>
      </div>
      <div class="mt-3">
        <div class="row g-2">
          <div class="col-sm-8">
            <div class="input-group">
              <span class="input-group-text bg-transparent text-white border-white"><i class="fas fa-search"></i></span>
              <input id="searchInput" type="text" class="form-control border-white" placeholder="Tìm theo tiêu đề...">
            </div>
          </div>
          <div class="col-sm-4 text-sm-end">
            <span class="badge bg-warning text-dark">Tổng bài: @Model?.Count()</span>
          </div>
        </div>
      </div>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success shadow-sm">@TempData["Success"]</div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger shadow-sm">@TempData["ErrorMessage"]</div>
    }

    <!-- Card grid -->
    <div class="row g-4" id="postsGrid">
      @foreach (var post in Model ?? Enumerable.Empty<RestaurantMVC.Models.BlogEntry>())
      {
        var image = string.IsNullOrWhiteSpace(post.ImageUrl) ? $"https://placehold.co/600x400?text={Uri.EscapeDataString(post.Title ?? "Bài viết")}" : post.ImageUrl;
        <div class="col-12 col-md-6 col-lg-4 post-card" data-title="@(post.Title ?? "")">
          <div class="card h-100">
            <div class="ratio ratio-16x9">
              <img src="@image" alt="@post.Title" class="card-img-top" style="object-fit: cover;">
            </div>
            <div class="card-body d-flex flex-column">
              <h5 class="card-title mb-2">@post.Title</h5>
              <p class="text-muted mb-2">@post.Excerpt</p>
              <div class="d-flex justify-content-between align-items-center flex-wrap mb-3">
                <span class="badge bg-info text-dark"><i class="fas fa-user me-1"></i>@(post.Author ?? "Admin")</span>
                <span class="badge bg-primary"><i class="fas fa-calendar me-1"></i>@post.PublishedAt.ToString("dd/MM/yyyy")</span>
              </div>
              <div class="mt-auto d-flex justify-content-between">
                <div class="btn-group">
                  <a class="btn btn-sm btn-warning" href="@Url.Action("EditBlogEntry", new { id = post.Id })">
                    <i class="fas fa-edit me-1"></i>Sửa
                  </a>
                  <form method="post" action="@Url.Action("DeleteBlogEntry")" onsubmit="return confirm('Xóa bài viết này?');">
                    <input type="hidden" name="id" value="@post.Id" />
                    <button type="submit" class="btn btn-sm btn-danger">
                      <i class="fas fa-trash me-1"></i>Xóa
                    </button>
                  </form>
                </div>
                <a class="btn btn-sm btn-outline-secondary" href="@Url.Action("Details","Blog", new { id = post.Id })" target="_blank">
                  <i class="fas fa-external-link-alt me-1"></i>Xem
                </a>
              </div>
            </div>
          </div>
        </div>
      }
    </div>
  </div>
</section>

@section Scripts {
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const input = document.getElementById('searchInput');
      const cards = document.querySelectorAll('#postsGrid .post-card');
      input?.addEventListener('input', function(e) {
        const q = (e.target.value || '').toLowerCase();
        cards.forEach(c => {
          const t = (c.getAttribute('data-title') || '').toLowerCase();
          c.style.display = t.includes(q) ? '' : 'none';
        });
      });
    });
  </script>
}